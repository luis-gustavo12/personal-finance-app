<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/expenses.css}">
    <link rel="stylesheet" th:href="@{/css/tables.css}">
    <link rel="stylesheet" th:href="@{/css/search-bar.css}">
    <title>Despesas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
</head>
<body>
    
<div layout:fragment="content">
    <nav class="sidebar">
        <div class="main-routes">
            <a th:href="@{/dashboard}" class="nav-panel">Dashboard</a>

            <a th:href="@{/expenses/create}" class="nav-panel">Criar Despesa</a>

        </div>

    </nav>



    <main class="main-content">


        <section>
            <form method="get" class="controls-section" id="filter-incomes-form">
                <div class="filter-group">
                    <div class="filter-item">
                        <label for="month-select">Month</label>
                        <select name="month" id="month-select" class="form-control">
                            <option value="">Todos</option>
                            <option value="1">Janeiro</option>
                            <option value="2">Fevereiro</option>
                            <option value="3">Março</option>
                            <option value="4">Abril</option>
                            <option value="5">Maio</option>
                            <option value="6">Junho</option>
                            <option value="7">Julho</option>
                            <option value="8">Agosto</option>
                            <option value="9">Setembro</option>
                            <option value="10">Outubro</option>
                            <option value="11">Novembro</option>
                            <option value="12">Dezembro</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="year-select">Year</label>
                        <select id="year-select" name="year" class="form-control">
                            <option value="">Todos</option>
                            <option th:each="year : ${years}" th:value="${year}" th:text="${year}"></option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="currency-select">Moeda</label>
                        <select id="currency-select" name="currencyFlag" class="form-control">
                            <option value="">Todos</option>
                            <option th:each="currency : ${currencies}" th:value="${currency}" th:text="${currency}"></option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="payment-method-select">Forma de Pagamento</label>
                        <select id="payment-method-select" name="paymentMethodId" class="form-control">
                            <option value="">Todos</option>
                            <option th:each="pm : ${paymentMethods}" th:text="${pm.description}" th:value="${pm.id}"></option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="amount-min">Quantia mínima</label>
                        <input type="number" step="0.01" min="0" id="amount-min" name="minimumAmount" class="form-control decimal-field" placeholder="Min">
                    </div>
                    <div class="filter-item">
                        <label for="amount-max">Quantia máxima</label>
                        <input type="number" step="0.01" min="0" id="amount-max" name="maximumAmount" class="form-control decimal-field" placeholder="Max">
                    </div>
                    <div class="filter-item">
                        <label for="desc-search">Descrição</label>
                        <input type="text" id="desc-search" name="description" class="form-control" placeholder="Buscar Descrição">
                    </div>
                    <div class="filter-item">
                        <label for="categories-search">Categoria</label>
                        <select name="categoryId" id="categories-search" class="form-control">
                            <option value="">Todos</option>
                            <option th:each="cat : ${categories}" th:text="${cat.categoryName}" th:value="${cat.id}"></option>
                        </select>
                    </div>
                    <div th:if="${!userCards.isEmpty()}" class="filter-item">
                        <label for="card-filter">Cartões</label>
                        <select name="cardId" id="card-filter" class="form-control">
                            <option selected disabled>Selecione um cartão</option>
                            <option th:each="card : ${userCards}" th:value="${card.id}" th:text="${card.cardName}"></option>
                        </select>
                    </div>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn btn-primary" id="apply-filter">Filtrar</button>
                    <button type="reset" class="btn btn-secondary" id="reset-filter">Apagar</button>
                </div>

            </form>
        </section>

        <p th:if="${expenses.isEmpty}">
            Você não tem nenhuma despesa!!! Clique <a th:href="@{/expenses/create}" class="redirect-anchor">aqui </a> para criar uma
        </p>

        <div th:unless="${expenses.isEmpty}" class="expense-table">
            <table class="entity-display-table">
                <thead>
                    <tr>
                        <th>Método de Pagamento</th>
                        <th>Moeda</th>
                        <th>Quantidade</th>
                        <th>Extra</th>
                        <th>Categoria</th>
                        <th>Data da Despesa</th>
                        <th>Editar</th>
                    </tr>
                </thead>

                <tbody>
                <tr th:each="expense, expenseCount : ${expenses}">
                    <td th:text="${expense.paymentMethod.description}"></td>
                    <td th:text="${expense.currency.currencyFlag}"></td>
                    <td th:text="${expense.amount}"></td>
                    <td th:if="${expense.extraInfo != ''}" th:text="${expense.extraInfo}"></td>
                    <td th:text="${expense.category.categoryName}"></td>
                    <td th:text="${#temporals.format(expense.date, 'dd/MM/YYYY')}"></td>
                    <td>
                        <div class="action-icons">
                            <a th:href="@{/expenses/edit/{id}(id=${expense.id})}" title="Editar">
                                <i class="fas fa-pencil-alt edit-icon"></i>
                            </a>
                            <a th:href="@{/expenses/delete/{id}(id=${expense.id})}" title="Excluir">
                                <i class="fas fa-times delete-icon"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td th:text="'Total: ' + ${sum.userCurrency} + ' ' + ${#numbers.formatDecimal(sum.sum, 1, 2)}"></td>
                    </tr>
                </tfoot>

            </table>
        </div>
    </main>



</div>
<script type="module" th:src="@{/js/dist/expenses.js}"></script>
</body>
</html>